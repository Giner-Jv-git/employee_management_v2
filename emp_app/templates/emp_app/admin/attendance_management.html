{% extends 'emp_app/base.html' %}
{% load static %}

{% block title %}Attendance Management{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen -m-6 p-8">


        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                <h3 class="text-lg font-semibold text-gray-800">Total Employees</h3>
                <p class="text-3xl font-bold text-green-600">{{ employees.count }}</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <h3 class="text-lg font-semibold text-gray-800">Today's Records</h3>
                <p class="text-3xl font-bold text-blue-600">{{ recent_attendance.count }}</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500">
                <h3 class="text-lg font-semibold text-gray-800">Currently Working</h3>
                <p class="text-3xl font-bold text-yellow-600">{{ working_employees.count }}</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
                <h3 class="text-lg font-semibold text-gray-800">Absent Today</h3>
                <p class="text-3xl font-bold text-red-600">{{ absent_employees.count }}</p>
            </div>
        </div>

        <!-- Today's Attendance Status -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
            <div class="px-6 py-4 bg-green-50 border-b">
                <h2 class="text-xl font-semibold text-green-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Today's Attendance Status
                </h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-6">
                {% for employee in employees %}
                    {% with today_attendance=employee.today_attendance %}
                    <div class="border rounded-lg p-4 transition-all duration-200 hover:shadow-md
                        {% if today_attendance and not today_attendance.time_out %}bg-green-50 border-green-200
                        {% elif today_attendance and today_attendance.time_out %}bg-gray-50 border-gray-200
                        {% else %}bg-red-50 border-red-200{% endif %}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                {% if employee.profile_picture %}
                                    <img class="h-8 w-8 rounded-full object-cover mr-3" src="{{ employee.profile_picture.url }}" alt="{{ employee.name }}">
                                {% else %}
                                    <div class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold text-sm mr-3">
                                        {{ employee.name|first }}
                                    </div>
                                {% endif %}
                                <div>
                                    <p class="font-medium text-gray-900">{{ employee.name }}</p>
                                    <p class="text-sm text-gray-600">{{ employee.get_position_display }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                {% if today_attendance and not today_attendance.time_out %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <div class="w-2 h-2 bg-green-400 rounded-full mr-1 animate-pulse"></div>
                                        Working
                                    </span>
                                    <p class="text-xs text-gray-600 mt-1">In: {{ today_attendance.time_in|time:"g:i A" }}</p>
                                {% elif today_attendance and today_attendance.time_out %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                        Complete
                                    </span>
                                    <p class="text-xs text-gray-600 mt-1">Out: {{ today_attendance.time_out|time:"g:i A" }}</p>
                                {% else %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        Absent
                                    </span>
                                    <p class="text-xs text-gray-600 mt-1">Not clocked in</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                {% endfor %}
            </div>
        </div>

        

       
        
    </div>
</div>
{% endblock %}